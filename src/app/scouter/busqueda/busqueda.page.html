<ion-content [fullscreen]="true">
  <ng-container *ngIf="!filtrosActivos || filtrosActivos.length === 0">
    <div class="welcome-screen">
      <h2>Búsqueda avanzada</h2>
      <p>Utiliza los filtros para encontrar jugadores que se ajusten a tus necesidades. Haz clic en <b>Filtros</b> para comenzar.</p>
      <ion-button expand="block" (click)="abrirModalFiltros()" class="filtros-btn">
        <ion-icon name="options-outline"></ion-icon>
        Filtros
      </ion-button>
    </div>
  </ng-container>
  <ng-container *ngIf="filtrosActivos && filtrosActivos.length > 0">
    <div class="filtros-bar" *ngIf="filtrosActivos && filtrosActivos.length > 0">
      <ion-chip *ngFor="let filtro of filtrosActivos">
        <ion-label>{{ filtro.label }}: {{ filtro.value }}</ion-label>
        <ion-icon name="close-circle" (click)="borrarFiltro(filtro.key)"></ion-icon>
      </ion-chip>
      <ion-chip class="chip-filtros-btn" (click)="abrirModalFiltros()">
        <ion-icon name="options-outline"></ion-icon>
        <ion-label>Filtros</ion-label>
      </ion-chip>
    </div>
    <!-- Resultados -->
    <div class="resultados-wrapper" *ngIf="resultados.length > 0">
      <h2 class="titulo-resultados">Resultados</h2>
      <div class="resultados-lista">
        <div *ngFor="let r of pagedResultados" class="resultado-card">
          <div class="avatar-wrapper">
            <img [src]="r.usuario.fotoPerfil || 'assets/default-profile.png'" alt="Foto de perfil" />
          </div>
          <div class="info-wrapper">
            <h2>{{ r.usuario.nombre }}</h2>
            <p>Coincidencia: <b>{{ r.porcentaje }}%</b></p>
            <p *ngIf="r.usuario.info">
              Altura: {{ r.usuario.info && r.usuario.info.altura != null ? (r.usuario.info.altura < 3 ? (r.usuario.info.altura * 100) : r.usuario.info.altura) + ' cm' : 'N/A' }} |
              Peso: {{ r.usuario.info && r.usuario.info.peso != null ? r.usuario.info.peso + ' kg' : 'N/A' }} |
              Edad: {{ r.edadCalculada != null ? r.edadCalculada : 'N/A' }}
            </p>
          </div>
        </div>
        <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMore($event)">
          <ion-infinite-scroll-content loadingSpinner="crescent" loadingText="Cargando más resultados..."></ion-infinite-scroll-content>
        </ion-infinite-scroll>
      </div>
    </div>
    <ion-note *ngIf="resultados.length === 0">No hay resultados para los filtros seleccionados.</ion-note>
  </ng-container>
  <!-- Modal de filtros -->
  <ion-modal #modalFiltros>
    <ng-template>
      <ion-content>
        <form #filtrosForm="ngForm" (ngSubmit)="aplicarFiltros(filtrosForm.value, modalFiltros)" autocomplete="off">
          <ion-card>
            <ion-card-header>
              <ion-card-title class="modal-title">Filtros físicos</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-item>
                <ion-label position="stacked">Altura (cm)</ion-label>
                <ion-input type="number" name="altura" ngModel min="100" max="250" pattern="^[0-9]*$"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="stacked">Peso (kg)</ion-label>
                <ion-input type="number" name="peso" ngModel min="30" max="200" pattern="^[0-9]*$"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="stacked">Edad</ion-label>
                <ion-input type="number" name="edad" ngModel min="10" max="60" pattern="^[0-9]*$"></ion-input>
              </ion-item>
            </ion-card-content>
          </ion-card>
          <ion-card>
            <ion-card-header>
              <ion-card-title class="modal-title">Filtros deportivos (Stats)</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-item *ngFor="let stat of ['velocidad','resistencia','fuerza','agilidad','equilibrio','coordinacion','salto','controlBalon','regate','pase','tiro','cabeceo']">
                <ion-label position="stacked">{{ stat | titlecase }}</ion-label>
                <ion-input type="number" [name]="stat" ngModel min="1" max="100" pattern="^[0-9]*$"></ion-input>
              </ion-item>
            </ion-card-content>
          </ion-card>
          <ion-button expand="block" type="submit" color="primary" class="aplicar-btn">Aplicar filtros</ion-button>
          <ion-button expand="block" fill="clear" color="medium" (click)="modalFiltros.dismiss()" class="cancelar-btn">Cancelar</ion-button>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
