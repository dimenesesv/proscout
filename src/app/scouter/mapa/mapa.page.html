<div class="refresh-spinner-bar" *ngIf="isRefreshing">
  <div class="spinner-bar-inner">
    <ion-spinner name="crescent"></ion-spinner>
    <span class="refresh-text">Actualizando...</span>
  </div>
</div>
<ion-content [fullscreen]="true">
  <div class="circle-top">
  </div>
  <div class="mapa-title-container">
    <span class="mapa-subtitle">Explora</span>
    <h1 class="mapa-title">Jugadores Cercanos</h1>
  </div>

  <div *ngIf="comuna || ciudad" style="display: flex; justify-content: center; margin-top: 0.5rem;">
    <ion-chip color="primary" style="font-size:1.08rem; font-weight:600;" (click)="abrirModalUbicacion()">
      <ion-icon name="location-outline" style="margin-right:6px;"></ion-icon>
      <ion-label>{{ comuna ? comuna + ',' : '' }} {{ ciudad }}</ion-label>
    </ion-chip>
  </div>

  <ion-spinner *ngIf="isLoading" name="crescent" class="spinner-center center-spinner"></ion-spinner>
  <ion-note *ngIf="locationError" color="danger" class="ion-text-center" style="margin-top:2rem;">
    No se pudo obtener tu ubicaci칩n. Por favor revisa los permisos de localizaci칩n y vuelve a intentarlo.
  </ion-note>
  <div *ngIf="!isLoading && !locationError">
    <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
      <ion-refresher-content pullingIcon="" refreshingSpinner="" pullingText="" refreshingText=""></ion-refresher-content>
    </ion-refresher>
    <div class="jugadores-grid" *ngIf="pagedUsers.length > 0" style="margin: 0 12px;">
      <div class="jugador-card perfil-card animate-card" *ngFor="let user of pagedUsers; let i = index" (click)="verPerfil(user)" [style.animationDelay]="(i * 80) + 'ms'">
        <div class="imagen-con-label">
          <img [src]="user.fotoPerfil || 'assets/default-profile.png'" alt="Foto de perfil" />
          <div hidden="true" class="etiqueta-nueva">NEW</div>
        </div>
        <div class="info-contenido">
          <div class="ubicacion">
            <ion-icon name="location-outline"></ion-icon>
            {{ user.comuna || 'Comuna desconocida' }}
          </div>
          <div class="nombre-edad">
            <strong class="nombre">{{ user.nombre }}</strong>
            <span class="edad">{{ user.fechaNacimiento ? (calcularEdad(user.fechaNacimiento)) + ' a침os' : '--' }}</span>
          </div>
        </div>
      </div>
    </div>
    <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMore($event)">
      <ion-infinite-scroll-content loadingSpinner="crescent" loadingText="Cargando m치s jugadores..."></ion-infinite-scroll-content>
    </ion-infinite-scroll>
    <ion-note *ngIf="users.length === 0" color="medium" class="ion-text-center" style="margin-top:2rem;">No hay jugadores cercanos.</ion-note>
  </div>
</ion-content>